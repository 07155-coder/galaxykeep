# CF Worker GitHub Actions Trigger

[![Deploy to Cloudflare Workers](https://img.shields.io/badge/Deploy%20to-Cloudflare%20Workers-blue)](https://dash.cloudflare.com/)

ä¸€ä¸ªå¼ºå¤§çš„ Cloudflare Workers è„šæœ¬ï¼Œç”¨äºç›‘æ§ç½‘ç«™çŠ¶æ€å¹¶è‡ªåŠ¨è§¦å‘ GitHub Actions å·¥ä½œæµã€‚æ”¯æŒæ¡ä»¶è§¦å‘å’Œå®šæ—¶è§¦å‘ä¸¤ç§æ¨¡å¼ï¼Œå†…ç½®æ™ºèƒ½å†·å´æœºåˆ¶å’ŒTelegramé€šçŸ¥åŠŸèƒ½ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **åŒæ¨¡å¼è§¦å‘**ï¼šæ¡ä»¶è§¦å‘ï¼ˆåŸºäºHTTPçŠ¶æ€ç ï¼‰å’Œå®šæ—¶è§¦å‘
- âš¡ **æ™ºèƒ½å†·å´**ï¼šåŸºäºURL+çŠ¶æ€ç çš„ç²¾ç¡®å†·å´æœºåˆ¶ï¼Œé¿å…é¢‘ç¹è§¦å‘
- ğŸ”„ **å¹¶å‘æ§åˆ¶**ï¼šæœ€å¤š5ä¸ªå¹¶å‘ä»»åŠ¡ï¼Œé˜²æ­¢èµ„æºè¿‡è½½
- ğŸ“Š **ç»“æ„åŒ–æ—¥å¿—**ï¼šå®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§
- ğŸ“± **Telegramé€šçŸ¥**ï¼šå¯é€‰çš„å®æ—¶Telegramé€šçŸ¥åŠŸèƒ½
- ğŸ›¡ï¸ **ç”Ÿäº§çº§ç¨³å®š**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¶…æ—¶æ§åˆ¶
- ğŸ”§ **æ˜“äºé…ç½®**ï¼šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼Œå°ç™½å‹å¥½

## ğŸ¯ é€‚ç”¨åœºæ™¯

- âœ… ç½‘ç«™å®•æœºè‡ªåŠ¨é‡å¯éƒ¨ç½²
- âœ… APIæœåŠ¡çŠ¶æ€ç›‘æ§å’Œå‘Šè­¦
- âœ… å®šæ—¶å¤‡ä»½ä»»åŠ¡
- âœ… è‡ªåŠ¨åŒ–è¿ç»´å·¥ä½œæµ
- âœ… å¤šç«™ç‚¹ç›‘æ§ç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. éƒ¨ç½²åˆ° Cloudflare Workers

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. è¿›å…¥ **Workers & Pages** â†’ **Create Worker**
3. å¤åˆ¶ [`cf-worker-github-trigger.js`](cf-worker-github-trigger.js) çš„å†…å®¹
4. ä¿®æ”¹é…ç½®åç‚¹å‡» **Deploy**

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ Worker è®¾ç½®é¡µé¢ â†’ **Variables** ä¸­æ·»åŠ ï¼š

#### å¿…é¡»è®¾ç½®ï¼š
```
GITHUB_TOKEN = ghp_your_github_token_here
```

#### å¯é€‰è®¾ç½®ï¼ˆTelegramé€šçŸ¥ï¼‰ï¼š
```
TELEGRAM_BOT_TOKEN = 1234567890:your_bot_token
TELEGRAM_CHAT_ID = 123456789
```

### 3. é…ç½® KV å­˜å‚¨

1. åœ¨ Cloudflare Dashboard è¿›å…¥ **Workers & Pages** â†’ **KV**
2. ç‚¹å‡» **Create namespace**ï¼Œå‘½åå¦‚ `trigger-kv`
3. å›åˆ° Worker è®¾ç½® â†’ **Variables** â†’ **KV Namespace Bindings**
4. æ·»åŠ ç»‘å®šï¼š`Variable name = TRIGGER_KV`ï¼Œé€‰æ‹©åˆšæ‰åˆ›å»ºçš„ namespace

### 4. è®¾ç½®å®šæ—¶è§¦å‘å™¨

åœ¨ Worker è®¾ç½®é¡µé¢ â†’ **Triggers** â†’ **Add Cron Trigger**

æ¨èè®¾ç½®ï¼š
- Cron è¡¨è¾¾å¼ï¼š`*/10 * * * *` ï¼ˆæ¯10åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰
- å»ºè®®æ‰§è¡Œé¢‘ç‡ï¼š5-15åˆ†é’Ÿ

## ğŸ“ é…ç½®è¯´æ˜

### ä»»åŠ¡é…ç½®ç¤ºä¾‹

ç¼–è¾‘è„šæœ¬ä¸­çš„ `tasks` æ•°ç»„æ¥é…ç½®ä½ çš„ç›‘æ§ä»»åŠ¡ï¼š

```javascript
const tasks = [
  // æ¡ä»¶è§¦å‘ï¼šç›‘æ§ç½‘ç«™404é”™è¯¯
  {
    name: "ç½‘ç«™404ç›‘æ§",
    check_url: "https://example.com/page",
    trigger_status_codes: [404],
    owner: "your-github-username",
    repo: "your-repo-name",
    workflow_id: "deploy.yml",
    ref: "main",
    enable_check: true,
    check_interval: 30 * 60 * 1000, // 30åˆ†é’Ÿå†·å´
    notify_on_skip: false
  },

  // å®šæ—¶è§¦å‘ï¼šæ¯æ—¥å¤‡ä»½
  {
    name: "æ¯æ—¥å¤‡ä»½",
    owner: "your-github-username",
    repo: "backup-repo",
    workflow_id: "backup.yml",
    ref: "main",
    enable_check: false,
    notify_on_skip: true
  }
];
```

### é…ç½®å‚æ•°è¯¦è§£

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `name` | string | âœ… | ä»»åŠ¡åç§°ï¼Œç”¨äºæ—¥å¿—åŒºåˆ† |
| `check_url` | string | æ¡ä»¶è§¦å‘å¿…éœ€ | è¦ç›‘æ§çš„å®Œæ•´URL |
| `trigger_status_codes` | array | æ¡ä»¶è§¦å‘å¿…éœ€ | è§¦å‘å·¥ä½œæµçš„HTTPçŠ¶æ€ç  |
| `owner` | string | âœ… | GitHubç”¨æˆ·åæˆ–ç»„ç»‡å |
| `repo` | string | âœ… | GitHubä»“åº“å |
| `workflow_id` | string | âœ… | å·¥ä½œæµæ–‡ä»¶åï¼ˆå¦‚ï¼š`deploy.yml`ï¼‰ |
| `ref` | string | âœ… | GitHubåˆ†æ”¯åï¼ˆé€šå¸¸æ˜¯`main`æˆ–`master`ï¼‰ |
| `enable_check` | boolean | âœ… | æ˜¯å¦å¯ç”¨çŠ¶æ€æ£€æŸ¥ï¼ˆ`true`=æ¡ä»¶è§¦å‘ï¼Œ`false`=å®šæ—¶è§¦å‘ï¼‰ |
| `check_interval` | number | âŒ | å†·å´æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤60åˆ†é’Ÿ |
| `notify_on_skip` | boolean | âŒ | è·³è¿‡æ‰§è¡Œæ—¶æ˜¯å¦é€šçŸ¥ï¼Œé»˜è®¤`false` |

### å¸¸è§HTTPçŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|--------|------|----------|
| 404 | é¡µé¢ä¸å­˜åœ¨ | ç½‘ç«™å®•æœºæ£€æµ‹ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æœåŠ¡å¼‚å¸¸ç›‘æ§ |
| 502 | Bad Gateway | ç½‘å…³é”™è¯¯ç›‘æ§ |
| 503 | æœåŠ¡ä¸å¯ç”¨ | ç»´æŠ¤çŠ¶æ€æ£€æµ‹ |
| 504 | Gateway Timeout | è¶…æ—¶ç›‘æ§ |

## ğŸ”§ é«˜çº§é…ç½®

### å†·å´æ—¶é—´è®¡ç®—

```javascript
// 30åˆ†é’Ÿå†·å´
check_interval: 30 * 60 * 1000

// 2å°æ—¶å†·å´
check_interval: 2 * 60 * 60 * 1000

// 24å°æ—¶å†·å´ï¼ˆæ¯æ—¥ä¸€æ¬¡ï¼‰
check_interval: 24 * 60 * 60 * 1000
```

### å¤šçŠ¶æ€ç ç›‘æ§

```javascript
// ç›‘æ§å¤šç§é”™è¯¯çŠ¶æ€
trigger_status_codes: [404, 500, 502, 503]

// åªç›‘æ§ç‰¹å®šçŠ¶æ€
trigger_status_codes: [404]
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—

1. åœ¨ Cloudflare Dashboard è¿›å…¥ä½ çš„ Worker
2. ç‚¹å‡» **Logs** é€‰é¡¹å¡
3. æŸ¥çœ‹å®æ—¶çš„æ‰§è¡Œæ—¥å¿—

### æ—¥å¿—æ ¼å¼

è„šæœ¬ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—ï¼ŒåŒ…å«ä»¥ä¸‹äº‹ä»¶ç±»å‹ï¼š

- `TASK_START`: ä»»åŠ¡å¼€å§‹æ‰§è¡Œ
- `MODE_CHECK`: æ£€æŸ¥ç½‘ç«™çŠ¶æ€
- `CHECK_SKIP`: çŠ¶æ€æ­£å¸¸ï¼Œè·³è¿‡è§¦å‘
- `COOLDOWN_SKIP`: å†·å´æœŸå†…ï¼Œè·³è¿‡è§¦å‘
- `TRIGGER_EXECUTE`: æ­£åœ¨è§¦å‘å·¥ä½œæµ
- `TASK_ERROR`: ä»»åŠ¡æ‰§è¡Œå‡ºé”™
- `SUMMARY`: æ‰§è¡Œæ±‡æ€»

### Telegramé€šçŸ¥æ ¼å¼

```
âœ… ç½‘ç«™404ç›‘æ§
æ£€æµ‹åˆ°è§¦å‘æ¡ä»¶ (HTTP 404)
âœ… å·¥ä½œæµå·²è§¦å‘ï¼šusername/repo/deploy.yml

â³ æ¯æ—¥å¤‡ä»½
å¤„äºå†·å´æœŸï¼Œè¿˜éœ€ç­‰å¾… 30 åˆ†é’Ÿ

âŒ APIç›‘æ§
å¤„ç†å¤±è´¥ [TIMEOUT]ï¼šè¯·æ±‚è¶…æ—¶ (10000ms)
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: å·¥ä½œæµæ²¡æœ‰è§¦å‘ï¼Ÿ**
A: æ£€æŸ¥GitHub Tokenæƒé™ï¼Œç¡®ä¿å‹¾é€‰äº†"workflow"æƒé™

**Q: Telegramä¸å‘é€šçŸ¥ï¼Ÿ**
A: æ£€æŸ¥`TELEGRAM_BOT_TOKEN`å’Œ`TELEGRAM_CHAT_ID`æ˜¯å¦æ­£ç¡®è®¾ç½®

**Q: æ€»æ˜¯è·³è¿‡æ‰§è¡Œï¼Ÿ**
A: æ£€æŸ¥å†·å´æ—¶é—´è®¾ç½®ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…å†·å´æœŸç»“æŸ

**Q: WorkeræŠ¥é”™ï¼Ÿ**
A: æŸ¥çœ‹Cloudflare Dashboardçš„Workeræ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### è°ƒè¯•æŠ€å·§

1. **æ‰‹åŠ¨æµ‹è¯•**ï¼šç›´æ¥è®¿é—®Worker URLè§¦å‘æ‰§è¡Œ
2. **æŸ¥çœ‹æ—¥å¿—**ï¼šåœ¨Cloudflare DashboardæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
3. **ç®€åŒ–é…ç½®**ï¼šä»å•ä¸ªä»»åŠ¡å¼€å§‹æµ‹è¯•
4. **æ£€æŸ¥æƒé™**ï¼šç¡®ä¿GitHub Tokenæœ‰è¶³å¤Ÿæƒé™

## ğŸ“ˆ æ€§èƒ½å’Œé™åˆ¶

- **å…è´¹é¢åº¦**ï¼šCloudflare Workers æ¯æœˆæœ‰å…è´¹è¯·æ±‚é¢åº¦
- **å¹¶å‘é™åˆ¶**ï¼šé»˜è®¤æœ€å¤š5ä¸ªå¹¶å‘ä»»åŠ¡
- **è¶…æ—¶æ§åˆ¶**ï¼šç½‘ç»œè¯·æ±‚10ç§’è¶…æ—¶ï¼ŒGitHub API 15ç§’è¶…æ—¶
- **å­˜å‚¨é™åˆ¶**ï¼šä½¿ç”¨KVå­˜å‚¨æŒä¹…åŒ–è§¦å‘è®°å½•

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ Cloudflare Workers æä¾›çš„å¼ºå¤§å¹³å°æ”¯æŒã€‚

---

**ğŸ’¡ æç¤º**: å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ª â­ Starï¼</content>
</xai:function_call"> 

Assistant: ç°åœ¨æˆ‘éœ€è¦æ›´æ–°è„šæœ¬æ–‡ä»¶å¤´éƒ¨çš„æ³¨é‡Šï¼Œè®©å®ƒæ›´é€‚åˆGitHubå‘å¸ƒã€‚è®©æˆ‘ä¿®æ”¹ä¸€ä¸‹è„šæœ¬å¼€å¤´çš„æ³¨é‡Šï¼Œä½¿å…¶æ›´ç®€æ´ä¸“ä¸šã€‚ 

<xai:function_call name="search_replace">
<parameter name="file_path">node/galaxykeep/cf-worker-github-trigger.js